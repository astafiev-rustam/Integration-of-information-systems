# Интеграция информационных систем с использованием API и микросервисов
|||
|---|---|
|Направление подготовки|Дополнительная профессиональная программа профессиональной переподготовки|
|Подразделение|ПИШ СВЧ-электроники|
|Курс, семестр|1 семестр|

# **Практическое занятие: "Разработка RESTful API, GraphQL и gRPC API в микросервисной архитектуре"**  

## **Введение**  
В современной разработке программного обеспечения микросервисная архитектура занимает ключевое место, позволяя разбивать сложные системы на независимые, легко масштабируемые компоненты. Одним из важных аспектов такой архитектуры является выбор протоколов взаимодействия между сервисами. Наиболее популярными подходами сегодня являются RESTful API, GraphQL и gRPC, каждый из которых имеет свои преимущества и сферы применения.  

Цель данного занятия — разработать три микросервиса, использующих разные технологии обмена данными, но работающих в рамках единой системы. В качестве примера мы возьмем упрощенную систему учета книг в библиотеке, где:  
- **RESTful API** будет отвечать за базовые CRUD-операции с книгами;  
- **GraphQL API** предоставит гибкий поиск по книгам с возможностью фильтрации;  
- **gRPC API** займется сбором статистики, например, подсчетом количества запросов.  

Такой подход позволит на практике сравнить особенности каждого протокола и понять, как они могут взаимодействовать в реальном проекте.  

---

## **Теоретическая часть**  

### **RESTful API**  
REST (Representational State Transfer) — это архитектурный стиль, основанный на использовании HTTP-методов (GET, POST, PUT, DELETE) для взаимодействия с ресурсами. Данные обычно передаются в формате JSON или XML.  

Ключевые особенности REST:  
- **Stateless** — каждый запрос содержит всю необходимую информацию для его обработки.  
- **Единообразие интерфейса** — четкие правила именования эндпоинтов.  
- **Кэширование** — возможность уменьшить нагрузку за счет хранения часто запрашиваемых данных.  

REST хорошо подходит для стандартных CRUD-операций, но может быть избыточным, если клиенту нужны только определенные поля данных.  

### **GraphQL**  
GraphQL — это язык запросов, разработанный Facebook, который позволяет клиентам точно указывать, какие данные им нужны. В отличие от REST, где сервер определяет структуру ответа, в GraphQL клиент сам формирует запрос, получая только необходимую информацию.  

Преимущества GraphQL:  
- **Гибкость** — можно запрашивать связанные данные за один запрос (например, книгу и её автора).  
- **Минимизация пересылаемых данных** — отсутствие проблемы over-fetching (когда REST возвращает лишние поля).  
- **Единственная конечная точка** — все запросы отправляются на `/graphql`.  

GraphQL особенно полезен в мобильных и SPA-приложениях, где важно экономить трафик.  

### **gRPC**  
gRPC — это высокопроизводительный фреймворк для удаленного вызова процедур (RPC), использующий Protocol Buffers (бинарный формат) и работающий поверх HTTP/2.  

Особенности gRPC:  
- **Высокая скорость** — бинарный формат делает обмен данными быстрее, чем JSON.  
- **Поддержка потоков** — возможность двусторонней потоковой передачи.  
- **Строгая типизация** — схема данных описывается в `.proto`-файлах.  

gRPC часто применяется в системах, где важна скорость и надежность, например, в микросервисах или real-time приложениях.  

---

## **Практическая часть**  

### **Постановка задачи**  
Мы разработаем систему управления книгами в библиотеке, состоящую из трех микросервисов:  
1. **RESTful API** — отвечает за добавление, удаление и редактирование книг.  
2. **GraphQL API** — позволяет выполнять сложные запросы, например, поиск книг по жанру.  
3. **gRPC API** — собирает статистику, такую как количество запросов или популярные книги.  

### **Шаг 1. Разработка RESTful API**  
Для реализации RESTful API можно использовать Node.js с Express или Python с FastAPI. Сервис будет предоставлять следующие эндпоинты:  
- `GET /books` — возвращает список всех книг.  
- `POST /books` — добавляет новую книгу.  
- `GET /books/:id` — получает книгу по её идентификатору.  
- `DELETE /books/:id` — удаляет книгу.  

Каждая книга содержит поля: `id`, `title`, `author` и `genre`. Данные могут храниться в памяти или в простой базе данных, например SQLite.  

### **Шаг 2. Разработка GraphQL API**  
GraphQL-сервис будет работать поверх тех же данных, что и REST, но предоставлять более гибкий интерфейс. Схема может выглядеть так:  

```graphql
type Book {
  id: ID!
  title: String!
  author: String!
  genre: String!
}

type Query {
  books(genre: String, author: String): [Book!]!
}
```

Пример запроса:  
```graphql
query {
  books(genre: "Фантастика") {
    title
    author
  }
}
```

Этот сервис можно реализовать с помощью Apollo Server (Node.js) или Graphene (Python).  

### **Шаг 3. Разработка gRPC API**  
gRPC-сервис будет отвечать за сбор статистики. Сначала нужно описать прото-файл:  

```protobuf
service LibraryStats {
  rpc GetStats (StatsRequest) returns (StatsResponse);
}

message StatsRequest {}

message StatsResponse {
  int32 total_books = 1;
  int32 total_requests = 2;
}
```

Затем реализовать сервер, который будет считать количество книг и запросов. Клиент (например, REST API) может вызывать этот сервис для обновления статистики.  

### **Шаг 4. Интеграция сервисов**  
Чтобы система работала как единое целое, можно:  
- Настроить REST API для вызова gRPC при добавлении новой книги.  
- Использовать GraphQL для агрегации данных из REST и gRPC.  

Например, GraphQL-запрос может возвращать не только книги, но и статистику по ним.  

---

## **Заключение**  
В ходе занятия мы разработали три микросервиса, использующих разные технологии обмена данными. RESTful API предоставил стандартный интерфейс для управления книгами, GraphQL дал возможность гибкого поиска, а gRPC обеспечил быстрый сбор статистики.  

Такая архитектура демонстрирует, как разные протоколы могут дополнять друг друга в реальных проектах. В дальнейшем систему можно расширить, добавив аутентификацию, базу данных или дополнительные сервисы.  

Для углубленного изучения рекомендуется ознакомиться с документацией REST, GraphQL и gRPC, а также рассмотреть готовые примеры на GitHub.

#### **Пример 1: Система управления задачами**  
- **REST API** – CRUD задач (создание, удаление, обновление)  
- **GraphQL API** – Гибкие запросы (например, задачи + пользователи за один запрос)  
- **gRPC API** – Уведомления в реальном времени (например, об изменении статуса задачи)  

#### **Пример 2: Интернет-магазин**  
- **REST API** – Управление товарами и заказами  
- **GraphQL API** – Агрегация данных (товар + отзывы + рекоммендации)  
- **gRPC API** – Обработка платежей (быстрый и надежный обмен данными)  
